import{j as e,af as A,ag as P,al as c,am as M,an as H}from"./index-BPHMtrqk.js";import{b as i,c as j,L as K}from"./react-vendor-DhpLdmKq.js";import{m as L,p as g,B as f,u as I,q as y,g as F,k as V}from"./button-DBX3xopU.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p=L("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]),w=i.forwardRef(({className:a,...s},t)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:t,className:g("w-full caption-bottom text-sm",a),...s})}));w.displayName="Table";const v=i.forwardRef(({className:a,...s},t)=>e.jsx("thead",{ref:t,className:g("[&_tr]:border-b",a),...s}));v.displayName="TableHeader";const S=i.forwardRef(({className:a,...s},t)=>e.jsx("tbody",{ref:t,className:g("[&_tr:last-child]:border-0",a),...s}));S.displayName="TableBody";const O=i.forwardRef(({className:a,...s},t)=>e.jsx("tfoot",{ref:t,className:g("border-t bg-neutral-100/50 font-medium [&>tr]:last:border-b-0 dark:bg-neutral-800/50",a),...s}));O.displayName="TableFooter";const m=i.forwardRef(({className:a,...s},t)=>e.jsx("tr",{ref:t,className:g("border-b transition-colors hover:bg-neutral-100/50 data-[state=selected]:bg-neutral-100 dark:hover:bg-neutral-800/50 dark:data-[state=selected]:bg-neutral-800",a),...s}));m.displayName="TableRow";const k=i.forwardRef(({className:a,...s},t)=>e.jsx("th",{ref:t,className:g("h-10 px-2 text-left align-middle font-medium text-gray-800 [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px] dark:text-white",a),...s}));k.displayName="TableHead";const b=i.forwardRef(({className:a,...s},t)=>e.jsx("td",{ref:t,className:g("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...s}));b.displayName="TableCell";const U=i.forwardRef(({className:a,...s},t)=>e.jsx("caption",{ref:t,className:g("mt-4 text-sm text-neutral-500 dark:text-neutral-400",a),...s}));U.displayName="TableCaption";const B=a=>{const s=typeof a=="string"?parseFloat(a):a;if(typeof s!="number"||isNaN(s))return console.warn("Invalid rank provided to getOrdinalSuffix:",a),"N/A";const t=Math.abs(Math.round(s)),n=t%10,d=t%100;if(d>=11&&d<=13)return t+"th";switch(n){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd";default:return t+"th"}},q=a=>[{accessorKey:"name",header:({column:s})=>e.jsxs(f,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Name",e.jsx(p,{className:"ml-2"})]})},{accessorKey:"departments",header:({column:s})=>e.jsxs(f,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Departments",e.jsx(p,{className:"ml-2"})]})},{accessorKey:"total_ratings",header:({column:s})=>e.jsxs(f,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Total Ratings",e.jsx(p,{className:"ml-2"})]}),minSize:50,maxSize:100},{accessorKey:"empirical_bayes_average",header:({column:s})=>e.jsxs(f,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Rating",e.jsx(p,{className:"ml-2"})]}),cell:({row:s,getValue:t})=>{var n;return e.jsxs("strong",{children:[e.jsx("span",{style:{color:A[a].harvard},children:(n=t())==null?void 0:n.toFixed(3)}),e.jsxs("span",{children:["  (",s.original.overall_letter_grade,") (",B(s.original.empirical_bayes_rank),")"]})]})}},{accessorKey:"intra_department_metrics",header:({column:s})=>e.jsxs(f,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Department Metrics",e.jsx(p,{className:"ml-2"})]}),size:160,cell:({row:s})=>{const t=s.getValue("intra_department_metrics");return e.jsx("div",{children:e.jsx("div",{children:e.jsx("span",{children:t})})})}}],z=()=>e.jsx(m,{children:Array.from({length:5}).map((a,s)=>e.jsx(b,{children:e.jsx("div",{className:"h-4 w-full animate-pulse rounded bg-gray-200 dark:bg-gray-700"})},s))}),G=({data:a,isLoading:s})=>{const[t,n]=j.useState([]),[d,N]=j.useState({}),{mode:u}=P(),x=j.useMemo(()=>q(u),[u]),h=I({data:a,columns:x,onSortingChange:n,getCoreRowModel:F(),getSortedRowModel:V(),onColumnVisibilityChange:N,state:{sorting:t,columnVisibility:d},enableGlobalFilter:!0});return s?e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Professor Scores (Overall)"}),e.jsx("div",{className:"rounded-md border flex-1 overflow-y-auto",children:e.jsxs(w,{className:"w-full table-fixed",children:[e.jsx(v,{children:h.getHeaderGroups().map(o=>e.jsx(m,{children:o.headers.map(r=>e.jsx(k,{className:"truncate",children:r.isPlaceholder?null:y(r.column.columnDef.header,r.getContext())},r.id))},o.id))}),e.jsx(S,{children:Array.from({length:30}).map((o,r)=>e.jsx(z,{},r))})]})})]}):e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Professor Scores (Overall)"}),e.jsx("div",{className:"rounded-md border flex-1 overflow-y-auto",children:e.jsxs(w,{className:"w-full table-fixed",children:[e.jsx(v,{children:h.getHeaderGroups().map(o=>e.jsx(m,{children:o.headers.map(r=>e.jsx(k,{className:"truncate",children:r.isPlaceholder?null:y(r.column.columnDef.header,r.getContext())},r.id))},o.id))}),e.jsx(S,{children:h.getRowModel().rows.length>0?h.getRowModel().rows.map(o=>e.jsx(m,{"data-state":o.getIsSelected()&&"selected",children:o.getVisibleCells().map(r=>e.jsx(b,{children:y(r.column.columnDef.cell,r.getContext())},r.id))},o.id)):e.jsx(m,{children:e.jsx(b,{colSpan:x.length,className:"h-24 text-center",children:"No results."})})})]})})]})},$=a=>{const s=typeof a=="string"?parseFloat(a):a;if(typeof s!="number"||isNaN(s))return console.warn("Invalid rank provided to getOrdinalSuffix:",a),"N/A";const t=Math.abs(Math.round(s)),n=t%10,d=t%100;if(d>=11&&d<=13)return t+"th";switch(n){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd";default:return t+"th"}},J=a=>[{accessorKey:"name",header:({column:s})=>e.jsxs(f,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Department",e.jsx(p,{className:"ml-2"})]})},{accessorKey:"empirical_bayes_average",header:({column:s})=>e.jsxs(f,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Average Score",e.jsx(p,{className:"ml-2"})]}),cell:({row:s,getValue:t})=>{var n;return e.jsxs("strong",{children:[e.jsx("span",{style:{color:A[a].harvard},children:(n=t())==null?void 0:n.toFixed(3)}),e.jsxs("span",{children:["  (Avg. Rank: ",$(Math.round(s.original.empirical_bayes_rank)),")"]})]})}}],Q=()=>e.jsx(m,{children:Array.from({length:2}).map((a,s)=>e.jsx(b,{children:e.jsx("div",{className:"h-4 w-full animate-pulse rounded bg-gray-200 dark:bg-gray-700"})},s))}),W=({data:a,isLoading:s})=>{var o;const[t,n]=j.useState([{id:"empirical_bayes_average",desc:!0}]),[d,N]=j.useState({}),{mode:u}=P(),x=j.useMemo(()=>J(u),[u]),h=I({data:a,columns:x,state:{sorting:t,columnVisibility:d},onSortingChange:n,onColumnVisibilityChange:N,getCoreRowModel:F(),getSortedRowModel:V(),enableGlobalFilter:!0});return s?e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Department Scores"}),e.jsx("div",{className:"rounded-md border flex-1 overflow-y-auto",children:e.jsxs(w,{className:"w-full table-fixed",children:[e.jsx(v,{children:h.getHeaderGroups().map(r=>e.jsx(m,{children:r.headers.map(l=>e.jsx(k,{className:"truncate",children:l.isPlaceholder?null:y(l.column.columnDef.header,l.getContext())},l.id))},r.id))}),e.jsx(S,{children:Array.from({length:30}).map((r,l)=>e.jsx(Q,{},l))})]})})]}):e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Department Scores"}),e.jsx("div",{className:"rounded-md border flex-1 overflow-y-auto",children:e.jsxs(w,{className:"w-full table-fixed",children:[e.jsx(v,{children:h.getHeaderGroups().map(r=>e.jsx(m,{children:r.headers.map(l=>e.jsx(k,{className:"truncate",children:l.isPlaceholder?null:y(l.column.columnDef.header,l.getContext())},l.id))},r.id))}),e.jsx(S,{children:(o=h.getRowModel().rows)!=null&&o.length?h.getRowModel().rows.map(r=>e.jsx(m,{"data-state":r.getIsSelected()&&"selected",children:r.getVisibleCells().map(l=>e.jsx(b,{children:y(l.column.columnDef.cell,l.getContext())},l.id))},r.id)):e.jsx(m,{children:e.jsx(b,{colSpan:x.length,className:"h-24 text-center",children:"No results."})})})]})})]})},ee=()=>{const[a,s]=i.useState([]),[t,n]=i.useState([]),[d,N]=i.useState(!0),[u,x]=i.useState(null);return i.useEffect(()=>{(async()=>{try{x(null);const[o,r]=await Promise.all([c.professors.toArray(),c.departments.toArray()]),l=await c.metadata.get("lastUpdate");let R=!1;if(o.length>0&&r.length>0&&l)try{const C=(await M()).headers["last-modified"];C&&new Date(C)<=new Date(l.value)&&(s(o),n(r),R=!0)}catch(D){console.warn("Failed to check server data, using cached data:",D),s(o),n(r),R=!0}if(!R){const[D,C]=await Promise.all([M(),H()]),E=new Date().toISOString(),T=D.data,_=C.data;await c.transaction("rw",c.professors,c.departments,c.metadata,async()=>{await Promise.all([c.professors.clear(),c.departments.clear(),T.length>0&&c.professors.bulkAdd(T),_.length>0&&c.departments.bulkAdd(_),c.metadata.put({key:"lastUpdate",value:E})])}),s(T),n(_)}}catch(o){console.error("Error fetching data:",o),x("Failed to load data. Please try refreshing the page.");try{const[r,l]=await Promise.all([c.professors.toArray(),c.departments.toArray()]);r.length>0&&l.length>0&&(s(r),n(l),x("Using cached data. Some information might be outdated."))}catch(r){console.error("Failed to load cached data:",r)}}finally{N(!1)}})()},[]),e.jsxs("div",{className:"professors-page",children:[u&&e.jsx("div",{className:"error-message",style:{color:"red",padding:"10px",textAlign:"center"},children:u}),e.jsx("div",{className:"guide",children:e.jsx("i",{children:e.jsx(K,{to:"/about",className:"guide-link",children:'Each number is calculated via empirical bayes across every course an instructor has taught based on the "Evaluate your Instructor overall" question. Department scores are naive averages.'})})}),e.jsxs("div",{className:"professors-container",children:[e.jsx("div",{className:"section-left",children:e.jsx(G,{data:a,isLoading:d})}),e.jsx("div",{className:"section-right",children:e.jsx(W,{data:t,isLoading:d})})]})]})};export{ee as default};
